# Task2. Описания возможных состояний

Таблица 1. Успешная транзакция

| Исходное состояние            | Переходное состояние          | Событие                                            |
|-------------------------------|-------------------------------|----------------------------------------------------|
| Заказ сформирован             | Резерв выполнен               | RESERVE_PRODUCTS                                   |
| Резерв выполнен               | Средства захолдированы        | HOLD_MONEY                                         |
| Средства захолдированы        | Проверка на фрод              | SEND_TO_ANTIFRAUD                                  |
| Проверка на фрод              | Проверка пройдена             | Сообщение от внешней системы о завершении проверки |
| Проверка пройдена             | Деньги списаны                | CHARGE_MONEY                                       |
| Деньги списаны                | Деньги переведены контрагенту | TRANSFER_MONEY                                     |
| Деньги переведены контрагенту | Завершена успешно             | Конечное состояние транзакции                      |


Таблица 2. Различные проблемные состояния

| Исходное состояние          | Переходное состояние        | Событие                                                                                                                                                                                                     |
|-----------------------------|-----------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Заказ сформирован           | Ошибка резерва              | RESERVE_PRODUCTS. Техническая ошибка: сервис резерва не ответил.                                                                                                                                            |
| Заказ сформирован           | Резерв не подтверждён       | RESERVE_PRODUCTS. Резревирование не может быть выполнено по причине того, что товар закончился                                                                                                              |
| Резерв выполнен             | Ошибка холдирования средств | HOLD_MONEY. Не удалось выполнить резерв средств, как техническое, так и по причине недостатка средств. Возможно имеет смысл различать эти состояний для обеспечения разных подходов к повтору холдирования. | 
| Средства захолдированы      | Ошибка отправки на проверку | SEND_TO_ANTIFRAUD. Техническая ошибка отправки на проверку на фрод.                                                                                                                                         |
| Проверка на фрод            | Проверка не пройдена        | Внешняя система информирует о том, что транзакция подозрительная                                                                                                                                            |
| Проверка не пройдена        | Снятие холда средств        | UNHOLD_MONEY. Отмена холдирования средств                                                                                                                                                                   |
| Снятие холда средств        | Отмена резерва              | UNRESERVE_PRODUCTS. Отмена резерва товаров на складе продавца                                                                                                                                               |
| Отмена резерва              | Завершена с ошибкой         | Конечное состояние транзакции                                                                                                                                                                               |
| Деньги списаны              | Ошибка списания             | CHARGE_MONEY. Техническая ошибка списания захолдированных средств                                                                                                                                           |                                                                                                                                         
| Ошибка списания             | Отмена резерва              | UNRESERVE_PRODUCTS                                                                                                                                                                                          |
| Деньги списаны              | Ошибка перевода контрагенту | TRANSFER_MONEY                                                                                                                                                                                              |
| Ошибка перевода контрагенту | Ручная обработка            | Если несколько попыток перевода средств на счёт контрагента не удались, то необходимо ручное вмешательство                                                                                                  |


